{
  "version": 3,
  "sources": ["../src/config.mjs", "../src/utility.mjs", "../src/data-types.mjs", "../src/editor.mjs", "../src/data-structure.mjs", "../src/dialog.mjs", "../src/settings.mjs", "../src/initialize.mjs"],
  "sourcesContent": ["export const CFG = {\n\tid: 'data-inspector',\n\tSETTINGS: {\n\t\tallowEditing: 'allowEditing',\n\t\tallowEditingUnsupported: 'allowEditingUnsupported',\n\t\tallowUsers: 'allowUsers',\n\t\tfunctions: 'functions',\n\t\tresults: 'results',\n\t\tmode: 'mode',\n\t\ttooltip: 'tooltip',\n\t},\n\tCOLORS: {\n\t\tmain: 'color:deepskyblue',\n\t\tnumber: 'color:mediumpurple',\n\t\tlabel: 'color:mediumseagreen',\n\t\tid: 'color:darkseagreen',\n\t\tunset: 'color:unset',\n\t},\n};\n", "export const copyToClipboard = async (text) => {\n\tif (window.isSecureContext) // Required\n\t\treturn navigator.clipboard.writeText(text);\n\telse\n\t\tui.notification.warn('Copying to clipboard requires secure contet (HTTPS) in modern browsers.');\n}\n", "/**\n * Recognized data types\n */\nexport const DATA_TYPES = {\n\tundefined: -1,\n\tnull: 0,\n\tobject: 110,\n\tnumber: 410,\n\tboolean: 420,\n\tstring: 430,\n\tarray: 120,\n\tmap: 510,\n\tcollection: 520,\n\tfunction: 910,\n\tgetter: 980,\n\tmodel: 1010,\n\tdata: 2010,\n\tdocument: 2020,\n\tcustom: 10000,\n}\n\nexport const DATA_TYPE_INVERTED = invertObject(DATA_TYPES);\n\n/**\n * Better type name getter.\n * @returns {String}\n */\nexport const getTypeName = (value) => {\n\tif (value === undefined) return 'undefined';\n\tif (value === null) return 'null';\n\tconst type = typeof value;\n\tif (['string', 'number', 'function', 'boolean'].includes(type)) return type;\n\tif (Array.isArray(value)) return 'array';\n\t// Gets class name more reliably than just value.contructor.name\n\tconst n = value.__proto__.constructor.name\n\tif (n === 'Object') return 'object';\n\tif (n === 'Map') return 'map';\n\treturn '_' + n; // underscore to ensure they don't conflict with the other names under any circumstances\n}\n\nexport const getModelType = (model) => {\n\tconst fields = foundry.data.fields;\n\tif (model instanceof fields.BooleanField)\n\t\treturn DATA_TYPES.boolean;\n\telse if (model instanceof fields.StringField)\n\t\treturn DATA_TYPES.string;\n\telse if (model instanceof fields.NumberField)\n\t\treturn DATA_TYPES.number;\n\telse if (model instanceof fields.ArrayField)\n\t\treturn DATA_TYPES.array;\n\telse if (model instanceof fields.ObjectField)\n\t\treturn DATA_TYPES.object;\n\telse if (model instanceof fields.SchemaField)\n\t\treturn DATA_TYPES.model;\n\telse if (model instanceof fields.EmbeddedDataField)\n\t\treturn DATA_TYPES.model;\n\n\treturn DATA_TYPES.custom;\n};\n\nexport const getTypeId = (value) => {\n\tif (value === undefined) return DATA_TYPES.undefined;\n\tif (value === null) return DATA_TYPES.null;\n\tconst type = typeof value;\n\tswitch (type) {\n\t\tcase 'string':\n\t\t\treturn DATA_TYPES.string;\n\t\tcase 'number':\n\t\t\treturn DATA_TYPES.number;\n\t\tcase 'function':\n\t\t\treturn DATA_TYPES.function;\n\t\tcase 'boolean':\n\t\t\treturn DATA_TYPES.boolean;\n\t}\n\tif (Array.isArray(value)) return DATA_TYPES.array;\n\tif (value instanceof foundry.abstract.Document) return DATA_TYPES.document;\n\tif (value instanceof foundry.abstract.DocumentData) return DATA_TYPES.data;\n\tif (value instanceof foundry.abstract.DataModel) return DATA_TYPES.model;\n\t// Gets class name more reliably than just value.contructor.name\n\tconst n = value.__proto__.constructor.name;\n\tif (n === 'Object') return DATA_TYPES.object;\n\tif (n === 'Map') return DATA_TYPES.map;\n\tif (n === 'Collection') return DATA_TYPES.collection;\n\treturn DATA_TYPES.custom;\n}\n", "import { CFG } from './config.mjs';\nimport { getTypeName, getTypeId, DATA_TYPES, DATA_TYPE_INVERTED } from './data-types.mjs';\n\nexport class ValueEditor extends FormApplication {\n\t_path;\n\t_type;\n\t/** @type {Actor|Item} */\n\tdocument;\n\n\t/** @type {DataInspectorDialog} */\n\tparentApp;\n\n\tstatic get supportedTypes() { return [DATA_TYPES.number, DATA_TYPES.string, DATA_TYPES.boolean, DATA_TYPES.null, DATA_TYPES.undefined]; }\n\n\tconstructor(document, path, type, { isToken = false, app, resolve } = {}) {\n\t\tconst title = ['Data Inspector'];\n\t\ttitle.push(document.name);\n\t\ttitle.push(path);\n\t\tconst options = {};\n\t\toptions.title = title.join(': ');\n\t\toptions.id = 'lil-data-inspector-' + document.uuid + '-' + path;\n\n\t\tsuper(undefined, options);\n\n\t\tthis.resolve = resolve;\n\n\t\tthis.parentApp = app;\n\t\tthis.isToken = isToken;\n\t\tthis._path = path;\n\t\t// this.object = { value: undefined };\n\t\tthis.document = document;\n\t\tconst value = getProperty(document.toObject(), path);\n\t\tthis.originalTypeId = type ?? getTypeId(value);\n\t\tthis.originalTypeName = DATA_TYPE_INVERTED[this.originalTypeId];\n\t\tthis._type = this.originalTypeName;\n\t\t// Register for updates\n\t\t// document.apps[this.appId] = this;\n\t}\n\n\tget template() {\n\t\treturn `modules/${CFG.id}/template/editor.hbs`;\n\t}\n\n\tstatic get defaultOptions() {\n\t\tconst _default = super.defaultOptions;\n\t\treturn mergeObject(_default, {\n\t\t\t..._default,\n\t\t\ttitle: 'Data Inspector \u2013 Editor',\n\t\t\tclasses: [..._default.classes, 'koboldworks', 'data-inspector-editor'],\n\t\t\tsubmitOnChange: false,\n\t\t\tsubmitOnClose: false,\n\t\t\tcloseOnSubmit: false,\n\t\t\tresizable: true,\n\t\t\twidth: 520,\n\t\t\theight: 360,\n\t\t});\n\t}\n\n\tasync getData() {\n\t\t// console.log('Editor.getData');\n\t\tconst data = super.getData();\n\n\t\tconst doc = this.document,\n\t\t\tvalue = getProperty(doc.toObject(), this._path),\n\t\t\ttypeId = this._typeId = getTypeId(value),\n\t\t\ttypeName = this._type ?? getTypeName(value),\n\t\t\toriginalTypeName = this.originalTypeName;\n\n\t\t// Required by {{editor}} to function\n\t\tthis.object = { value };\n\n\t\tdata.document = doc;\n\t\tdata.path = this._path;\n\t\tdata.value = value;\n\t\tdata.type = typeName;\n\t\tdata.typeName = typeName;\n\t\tdata.originalType = originalTypeName;\n\t\tdata.similarType = originalTypeName === 'string' && ['text', 'html'].includes(typeName);\n\t\tdata.isHTML = typeName === 'html';\n\t\tdata.isString = ['html', 'text', 'string'].includes(typeName);\n\t\tdata.isLongString = typeName === 'html' || typeName === 'text' || originalTypeName === 'string' && (data.value.length > 16 || data.value.indexOf('\\n') >= 0);\n\t\tdata.isUnsupported = !ValueEditor.supportedTypes.includes(typeId);\n\t\tdata.isActor = doc instanceof Actor;\n\t\tdata.isItem = doc instanceof Item;\n\t\t// data.isEditable = !data.isUnsupported;\n\t\t// data.isOwner = doc.isOwner;\n\t\tdata.simpleType = ['number', 'string', 'boolean'].includes(typeName);\n\t\tdata.deadType = ['null', 'undefined'].includes(typeName);\n\t\tdata.selectedType = this._type;\n\t\tdata.types = {\n\t\t\tnumber: 'Number',\n\t\t\tboolean: 'Boolean',\n\t\t\tstring: 'String',\n\t\t\tnull: 'Null',\n\t\t\tundefined: 'Undefined',\n\t\t\ttext: 'Text Block',\n\t\t\thtml: 'HTML'\n\t\t};\n\n\t\tdata.enriched = data.isHTML ? await TextEditor.enrichHTML(this.object.value, { async: true }) : null;\n\n\t\tdata.isToken = this.isToken;\n\n\t\tdata.TYPES = DATA_TYPES;\n\t\treturn data;\n\t}\n\n\t/**\n\t * @param {JQuery} jq\n\t */\n\tactivateListeners(jq) {\n\t\tsuper.activateListeners(jq);\n\t\tconst html = jq[0];\n\t\tconst app = this;\n\n\t\tconst parentApp = this.parentApp;\n\n\t\tconst isToken = this.isToken;\n\n\t\thtml.querySelector('select[name=\"type\"]')?.addEventListener('change', (ev) => {\n\t\t\tev.preventDefault();\n\t\t\tev.stopPropagation();\n\t\t\tconst oldType = this._type,\n\t\t\t\tnewType = ev.target.value;\n\t\t\tthis._type = newType;\n\t\t\t// console.log('Changing type from', oldType, 'to', newType);\n\t\t\tthis.render();\n\t\t});\n\n\t\t// Type swapping\n\t\thtml.querySelector('select[name=\"type\"]')\n\t\t\t?.addEventListener('change', function (ev) {\n\t\t\t\tev.preventDefault();\n\t\t\t\tev.stopPropagation();\n\t\t\t\tapp._type = this.value;\n\t\t\t\tapp.editors = {}; // Reset {{editor}}\n\t\t\t\tapp.render(true);\n\t\t\t});\n\n\t\tconst doc = this.document,\n\t\t\tpath = this._path;\n\n\t\t// Delete button listener\n\t\thtml.querySelector('button.delete')\n\t\t\t?.addEventListener('click', ev => {\n\t\t\t\tev.preventDefault();\n\t\t\t\tev.stopPropagation();\n\n\t\t\t\tconst dv = path.replace(/([^.]+)$/, (m) => `-=${m}`);\n\t\t\t\tconst updateData = { [dv]: null };\n\t\t\t\tconsole.log('Delete:', updateData);\n\n\t\t\t\tDialog.confirm({\n\t\t\t\t\ttitle: 'Delete data?',\n\t\t\t\t\tcontent: `<p>Delete: <code>${path}</code></p>`,\n\t\t\t\t\tyes: () => doc.update(updateData)\n\t\t\t\t\t\t.finally(_ => app.close()),\n\t\t\t\t\tdefaultYes: false\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\t_updateObject(event, formData) {\n\t\t// delete formData.type;\n\t\tconst type = this._type,\n\t\t\tpath = this._path,\n\t\t\tdoc = this.document;\n\n\t\tconsole.log(formData);\n\n\t\tlet value = formData.value;\n\t\tif (type === 'undefined') value = undefined;\n\t\telse if (type === 'null') value = null;\n\n\t\tconsole.log('Setting data:', type, path, value);\n\n\t\tconst updateData = { [path]: value };\n\t\t// console.log('UpdateData:', updateData);\n\n\t\tdoc.update(updateData).then(_ => this.close());\n\n\t\t// this.render();\n\t}\n\n\t/**\n\t * @override\n\t */\n\tasync close(opts) {\n\t\t// Unregister updates\n\t\t// delete this.document.apps[this.appId];\n\t\tthis.resolve();\n\t\treturn super.close(opts);\n\t}\n}\n", "import { getTypeId, getModelType, DATA_TYPES, DATA_TYPE_INVERTED } from './data-types.mjs';\n\nconst dataKeySorter = (a, b) => a.key.localeCompare(b.key);\n\nclass ChildKeyData {\n\tkey;\n\ttype;\n\tconstructor(key, type) {\n\t\tthis.key = key;\n\t\tthis.type = type;\n\t}\n}\n\nexport class DataStructure {\n\t/** @type {String} */\n\tkey;\n\t/** @type {String} */\n\tpath;\n\tget basePath() {\n\t\treturn this.path.replace(/^system\\./, '');\n\t}\n\n\t/** @type {String} */\n\ttype;\n\t/** @type {Number} */\n\ttypeId;\n\n\t/** @type {DataStructure} */\n\troot;\n\n\t/** @type {*} */\n\tvalue;\n\n\t/** @type {DataStructure} */\n\tparent;\n\t/** @type {DataStructure[]} */\n\tchildren = [];\n\t/** @type {Number} */\n\tdepth = 0;\n\t/** @type {String} */\n\ttreetype;\n\n\tget isRollData() {\n\t\treturn this.root.treetype === 'rolldata';\n\t}\n\n\t/** @type {Object|undefined} */\n\t_sourceData;\n\t/** @type {Object|undefined} */\n\t_derivedData;\n\t/** @type {Object|undefined} */\n\t_rollData;\n\t/** @type {object|undefined} */\n\t_overides;\n\n\t/** @type {Boolean} */\n\tstatic includeFunctions = false;\n\n\t/** @type {Boolean} */\n\tget isBigString() { return this.typeId === DATA_TYPES.string && this.value?.length > 24; }\n\n\t/** @type {Boolean} */\n\tget isNull() { return this.typeId === DATA_TYPES.null; }\n\n\t/** @type {Boolean} */\n\tget isFunction() { return this.typeId === DATA_TYPES.function; }\n\n\t/** @type {Boolean} */\n\tget isGetter() { return this.typeId === DATA_TYPES.getter; }\n\n\t/** @type {Boolean} */\n\tget isUndefined() { return this.typeId === DATA_TYPES.undefined; }\n\n\t/** @type {Boolean} */\n\tget isNullish() {\n\t\tif ([DATA_TYPES.null, DATA_TYPES.undefined].includes(this.typeId)) return true;\n\t\tif (this.isArray && this.value.length === 0) return true;\n\t\tif ((this.isMap || this.isCollection) && this.value.size == 0) return true;\n\t\treturn false;\n\t}\n\n\tget identifier() {\n\t\tswitch (this.typeId) {\n\t\t\tcase DATA_TYPES.custom:\n\t\t\tcase DATA_TYPES.model: return this.value.constructor.name;\n\t\t\tdefault: return null;\n\t\t}\n\t}\n\n\tget isModel() { return this.typeId === DATA_TYPES.model; }\n\n\t/** @type {Boolean} */\n\tget isArray() { return this.typeId === DATA_TYPES.array; }\n\n\tget isMap() { return this.typeId === DATA_TYPES.map; }\n\n\tget isCollection() { return this.typeId === DATA_TYPES.collection; }\n\n\t/** @type {Boolean} */\n\tget isObject() { return this.typeId === DATA_TYPES.object; }\n\n\t/** @type {Boolean} */\n\tget isDocument() { return [DATA_TYPES.document, DATA_TYPES.data].includes(this.typeId); }\n\n\tget documentId() {\n\t\tif (this.typeId === DATA_TYPES.data) return this.value._id;\n\t\tif (this.typeId === DATA_TYPES.document) return this.value.id;\n\t\treturn undefined;\n\t}\n\n\tget hasValues() {\n\t\tif (this.isContainer && !this.isArray) {\n\t\t\treturn ('total' in this.value || 'value' in this.value || 'max' in this.value);\n\t\t}\n\t\treturn false;\n\t}\n\n\tget values() {\n\t\tconst data = {\n\t\t\tvalue: this.value.value,\n\t\t\thaveValue: false,\n\t\t\tmax: this.value.max,\n\t\t\thaveMax: false,\n\t\t\tisValue: false,\n\t\t\ttotal: this.value.total,\n\t\t\thaveTotal: false,\n\t\t\tnoValues: false,\n\t\t};\n\n\t\tif (data.value === null || (typeof data.value === 'number')) {\n\t\t\tdata.value = `${data.value}`;\n\t\t\tdata.haveValue = true;\n\t\t}\n\t\tif (data.max === null || (typeof data.max === 'number')) {\n\t\t\tdata.max = `${data.max}`;\n\t\t\tdata.haveMax = true;\n\t\t}\n\t\tif (data.total === null || (typeof data.total === 'number')) {\n\t\t\tdata.total = `${data.total}`;\n\t\t\tdata.haveTotal = true;\n\t\t}\n\t\tif (data.haveValue || data.haveMax) {\n\t\t\tdata.isValue = true;\n\t\t\tdata.isValueOf = data.haveValue && data.haveMax;\n\t\t}\n\n\t\tif (!data.isValue && !data.haveTotal) data.noValues = true;\n\n\t\treturn data;\n\t}\n\n\t/** @type {String} */\n\tget className() { return this.value.__proto__.constructor.name; }\n\n\t/** @type {Boolean} */\n\tget isEmpty() {\n\t\tif (this.isNullish) return true;\n\t\tswitch (this.typeId) {\n\t\t\tcase DATA_TYPES.array:\n\t\t\t\treturn this.value.length == 0;\n\t\t\tcase DATA_TYPES.object:\n\t\t\t\treturn foundry.utils.isEmpty(this.value);\n\t\t\tcase DATA_TYPES.map:\n\t\t\tcase DATA_TYPES.collection:\n\t\t\t\treturn this.value.size === 0;\n\t\t\tcase DATA_TYPES.custom:\n\t\t\t\treturn this.children.length == 0;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/** @type {Boolean} */\n\tget isString() { return this.typeId === DATA_TYPES.string; }\n\n\t/** @type {Boolean} */\n\tget isNumber() { return this.typeId === DATA_TYPES.number; }\n\n\t/** @type {Boolean} */\n\tget inArray() { return this.parent?.isArray ?? false; }\n\n\t/** @type {Boolean} */\n\tget isContainer() { return [DATA_TYPES.array, DATA_TYPES.object, DATA_TYPES.model, DATA_TYPES.map, DATA_TYPES.collection, DATA_TYPES.custom].includes(this.typeId); }\n\n\tget isChildless() { return [DATA_TYPES.boolean, DATA_TYPES.string, DATA_TYPES.null, DATA_TYPES.undefined, DATA_TYPES.number].includes(this.typeId); }\n\n\t/** @type {Boolean} */\n\tget isCustom() { return this.typeId === DATA_TYPES.custom; }\n\n\t/** @type {String} */\n\tget formattedValue() {\n\t\tif (this.typeId === DATA_TYPES.undefined) return 'undefined';\n\t\tif (this.typeId === DATA_TYPES.null) return 'null';\n\t\tif (this.typeId === DATA_TYPES.function) {\n\t\t\t// console.log(this.path, 'FUNCTION', { fn: this.value });\n\t\t\treturn 'function';\n\t\t}\n\t\treturn this.value;\n\t}\n\n\t#inRoll;\n\t/** @type {Boolean} */\n\tget inRollData() {\n\t\tif (this.#inRoll === undefined) {\n\t\t\tif (this.root.treetype === 'rolldata') return this.#inRoll = true;\n\t\t\tif (!this.root._rollData) return false;\n\t\t\tconst path = this.basePath;\n\t\t\ttry {\n\t\t\t\treturn this.#inRoll = hasProperty(this.root._rollData, path);\n\t\t\t}\n\t\t\tcatch (err) {\n\t\t\t\t/* hasProperty() doesn't like \"invalid\" data  */\n\t\t\t}\n\t\t\treturn this.#inRoll = 3;\n\t\t}\n\t\treturn this.#inRoll;\n\t}\n\n\t#inSource;\n\t/** @type {Boolean} */\n\tget inSourceData() {\n\t\tif (this.#inSource === undefined) {\n\t\t\tif (this.root.treetype === 'source')\n\t\t\t\treturn this.#inSource = true;\n\t\t\tif (!this.root._sourceData)\n\t\t\t\treturn false;\n\t\t\tconst path = this.basePath;\n\t\t\ttry {\n\t\t\t\tconst data = this.root._sourceData;\n\t\t\t\treturn (this.#inSource = hasProperty(data, path));\n\t\t\t}\n\t\t\tcatch (err) {\n\t\t\t\t/* hasProperty() doesn't like \"invalid\" data  */\n\t\t\t}\n\t\t\treturn (this.#inSource = 3);\n\t\t}\n\t\treturn this.#inSource;\n\t}\n\n\t#inDerived;\n\t/** @type {Boolean} */\n\tget inDerivedData() {\n\t\tif (this.#inDerived === undefined) {\n\t\t\tif (this.root.treetype === 'derived') return this.#inDerived = true;\n\t\t\tif (!this.root._derivedData) return false;\n\t\t\tconst path = this.basePath;\n\t\t\ttry {\n\t\t\t\tconst data = this.root._derivedData;\n\t\t\t\treturn this.#inDerived = hasProperty(data, path);\n\t\t\t}\n\t\t\tcatch (err) {\n\t\t\t\t/* hasProperty() doesn't like \"invalid\" data  */\n\t\t\t}\n\t\t\treturn this.#inDerived = 3;\n\t\t}\n\t\treturn this.#inDerived;\n\t}\n\n\t#inTemporary;\n\tget inTemporaryData() {\n\t\tif (this.#inTemporary === undefined) {\n\t\t\tif (!this.root._temporaryData) return false;\n\t\t\tconst path = this.basePath;\n\t\t\ttry {\n\t\t\t\tconst data = this.root._temporaryData;\n\t\t\t\treturn this.#inTemporary = hasProperty(data, path);\n\t\t\t}\n\t\t\tcatch (err) {\n\t\t\t\t/* hasProperty() doesn't like \"invalid\" data  */\n\t\t\t}\n\t\t\treturn this.#inTemporary = 3;\n\t\t}\n\t\treturn this.#inTemporary;\n\t}\n\n\tget hasOverrides() {\n\t\treturn !!this._overrides;\n\t}\n\n\t/** @type {String} */\n\tget css() {\n\t\tif (this.typeId === DATA_TYPES.boolean)\n\t\t\treturn this.value ? 'true' : 'false';\n\t\tif (this.typeId === DATA_TYPES.number)\n\t\t\treturn this.value === 0 ? 'zero' : this.value < 0 ? 'negative' : 'positive';\n\t\treturn '';\n\t}\n\n\tconstructor({ key, path, value, parent, type, treeType, depth }) {\n\t\tthis.key = key;\n\t\tthis.path = path;\n\t\tthis.typeId = type ?? getTypeId(value);\n\t\tthis.type = DATA_TYPE_INVERTED[this.typeId];\n\t\tthis.value = value;\n\t\tthis.parent = parent;\n\t\tthis.root = parent?.root ?? parent;\n\t\tthis.depth = depth;\n\t\tthis.treetype = treeType;\n\n\t\t// if (this.typeId === DATA_TYPES.custom) console.log(this.type, this.typeId, value, value.constructor.name);\n\t}\n\n\t#childKeys;\n\t/** @type {ChildKeyData[]} */\n\tchildKeys() {\n\t\tif (this.#childKeys) return this.#childKeys;\n\t\tif (this.isDocument) return [];\n\t\tswitch (this.typeId) {\n\t\t\tcase DATA_TYPES.array:\n\t\t\t\treturn this.#childKeys = [this.value.map(k => new ChildKeyData(k))];\n\t\t\tcase DATA_TYPES.collection:\n\t\t\tcase DATA_TYPES.map:\n\t\t\t\treturn this.#childKeys = [Array.from(this.value.keys()).map(k => new ChildKeyData(k))];\n\t\t\tcase DATA_TYPES.model:\n\t\t\tcase DATA_TYPES.object:\n\t\t\tcase DATA_TYPES.custom: {\n\t\t\t\tconst allKeys = [], rvg = [], rvf = [];\n\t\t\t\tallKeys.push(...Object.getOwnPropertyNames(this.value).map(k => new ChildKeyData(k)));\n\n\t\t\t\tif (this.isModel) {\n\t\t\t\t\tlet i = allKeys.length;\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t// Reserved keys\n\t\t\t\t\t\tif (['parent', '_source'].includes(allKeys[i].key))\n\t\t\t\t\t\t\tallKeys.splice(i, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (DataStructure.includeFunctions) {\n\t\t\t\t\t// Find getters also\n\t\t\t\t\tlet proto = this.value;\n\t\t\t\t\tconst ignored = ['constructor', 'toString', 'almostEqual', '__proto__', 'prototype', 'between'];\n\t\t\t\t\tdo {\n\t\t\t\t\t\tif (proto.constructor.name === 'Object') break;\n\t\t\t\t\t\tconst keys = Object.getOwnPropertyNames(proto);\n\t\t\t\t\t\tfor (const key of keys) {\n\t\t\t\t\t\t\tif (ignored.includes(key)) continue;\n\t\t\t\t\t\t\tconst desc = Object.getOwnPropertyDescriptor(proto, key);\n\t\t\t\t\t\t\tif (!desc) continue; // ?\n\n\t\t\t\t\t\t\tif (desc.get !== undefined)\n\t\t\t\t\t\t\t\trvg.push(new ChildKeyData(key, DATA_TYPES.getter));\n\t\t\t\t\t\t\telse if (typeof desc.value === 'function')\n\t\t\t\t\t\t\t\trvf.push(new ChildKeyData(key, DATA_TYPES.function));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tproto = Object.getPrototypeOf(proto);\n\t\t\t\t\t}\n\t\t\t\t\twhile (proto);\n\t\t\t\t}\n\t\t\t\treturn this.#childKeys = [allKeys.sort(dataKeySorter), rvg.sort(dataKeySorter), rvf.sort(dataKeySorter)];\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\treturn this.#childKeys = [];\n\t\t}\n\t}\n\n\tfillChildren() {\n\t\tconst curpath = this.path,\n\t\t\tbasePath = curpath?.length ? curpath : this.key,\n\t\t\tisArray = this.isArray,\n\t\t\tisMap = this.isMap || this.isCollection;\n\n\t\tconst parseChildren = (list) => {\n\t\t\tlist?.forEach((ckData, i) => {\n\t\t\t\tconst { key, type } = ckData;\n\t\t\t\tconst trueKey = !isArray ? key : i,\n\t\t\t\t\tvalue = isMap ? this.value.get(trueKey) : this.value[trueKey];\n\t\t\t\tconst path = basePath ? `${basePath}.${trueKey}` : trueKey;\n\n\t\t\t\tconst rv = Hooks.call('data-inspector.filterData', this.root.document, path, this.treetype);\n\t\t\t\tif (rv === false) return; // Filtered out in hook\n\n\t\t\t\tconst typeId = getTypeId(value);\n\t\t\t\tif (typeId === DATA_TYPES.function && !DataStructure.includeFunctions) return; // Not including functions\n\t\t\t\tconst c = new DataStructure({ key: trueKey, path, value, parent: this, type, depth: this.depth + 1 });\n\t\t\t\tthis.children.push(c);\n\t\t\t});\n\t\t}\n\n\t\tconst [all, functions, getters] = this.childKeys();\n\n\t\tparseChildren(all);\n\t\tparseChildren(functions);\n\t\tparseChildren(getters);\n\n\t\treturn this.children;\n\t}\n\n\tstatic recurse(sourceData, key, path, type, { includeFunctions = false, document } = {}) {\n\t\tDataStructure.includeFunctions = includeFunctions ?? false;\n\n\t\tconst dt = new DataStructure({ key, path, value: sourceData, parent: null, treeType: type, depth: 0 });\n\t\tdt.document = document;\n\t\tdt.root = dt;\n\t\tconst all = {};\n\t\tif (dt.path) all[dt.path] = dt;\n\t\tlet itemCount = 0, error = false;\n\n\t\t/**\n\t\t * @param {DataStructure} cdt\n\t\t */\n\t\tconst recurseChildren = (cdt) => {\n\t\t\tconst handleChild = (oo) => {\n\t\t\t\tall[oo.path] = oo;\n\t\t\t\titemCount++;\n\t\t\t\tif (itemCount > 25000) {\n\t\t\t\t\tif (!error) {\n\t\t\t\t\t\tui.notifications.error('DATA INSPECTOR | Possible cyclic reference encountered; ending inspection early');\n\t\t\t\t\t\tconsole.error(oo.path, '\\nDATA INSPECTOR | Possible cyclic reference encountered; ending inspection early\\n', oo);\n\t\t\t\t\t\terror = true;\n\t\t\t\t\t}\n\t\t\t\t\treturn; // Arbitrary hard exit\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\trecurseChildren(oo);\n\t\t\t\t}\n\t\t\t\tcatch (err) {\n\t\t\t\t\tconsole.error(err, this);\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!cdt.isChildless) {\n\t\t\t\tcdt.fillChildren()\n\t\t\t\t\t.forEach(handleChild);\n\t\t\t}\n\t\t}\n\n\t\trecurseChildren(dt);\n\n\t\treturn { root: dt, all };\n\t}\n\n\t/*\n\thasChild(path) {\n\t\tconst parts = path.split('.');\n\t}\n\t*/\n\n\t/**\n\t * @param {String} path\n\t * @returns {DataStructure}\n\t */\n\tgetAtPath(path) {\n\t\tconst parts = path.split('.');\n\t\tconst key = parts.shift();\n\n\t\tconst getPart = () => {\n\t\t\tswitch (this.typeId) {\n\t\t\t\tcase DATA_TYPES.array: return this.children[parseInt(key)];\n\t\t\t\tdefault: return this.children.find(cd => cd.key === key);\n\t\t\t}\n\t\t};\n\n\t\tconst c = getPart();\n\n\t\tif (parts.length === 0) return c;\n\t\telse return c?.getAtPath(parts.join('.'));\n\t}\n}\n", "import { CFG } from './config.mjs';\nimport { copyToClipboard } from './utility.mjs';\nimport { getTypeId, DATA_TYPES, DATA_TYPE_INVERTED } from './data-types.mjs';\nimport { ValueEditor } from './editor.mjs';\nimport { DataStructure } from './data-structure.mjs';\n\nfunction createTemporaryDocument(doc) {\n\tconst data = { name: doc.name + ' [Temporary]', type: doc.type, system: { } };\n\tHooks.call('data-inspector.temporaryData', doc, data);\n\treturn doc instanceof Actor ? new Actor(data) : new Item(data);\n}\n\nclass SearchResult {\n\t/** @type {String} */\n\tpath;\n\n\t/** @type {Boolean} */\n\tkeyFocus = true;\n\n\t/** @type {Boolean} */\n\tmatch;\n\n\t/** @type {Boolean} */\n\tget mismatch() { return this.indexes.path.length === 0; }\n\n\t/**\n\t * Search target, what is being looked for.\n\t *\n\t * @type {Object}\n\t */\n\ttarget;\n\t/** @type {Number} */\n\tscore;\n\n\t/** @type {Boolean} */\n\tkeyFullMatch;\n\t/** @type {Boolean} */\n\tpathFullMatch;\n\n\tindexes = {\n\t\t/** @type {Number[]} */\n\t\tpath: [],\n\t\t/** @type {Number[]} */\n\t\tkey: [],\n\t};\n\n\t/** @type {Number} */\n\tratio;\n\t/** @type {Boolean} */\n\tget good() { return this.ratio > 0.8; }\n\t/** @type {Boolean} */\n\tget bad() { return this.ratio < 0.3; }\n\tscoring = {\n\t\t/** @type {Number} */\n\t\tfull: undefined,\n\t\t/** @type {Number} */\n\t\tkey: undefined,\n\t};\n\n\tconstructor({ path, match, target, score, keyFocus, keyFullMatch, pathFullMatch, pathIndexes, keyIndexes, ratio, scoring } = {}) {\n\t\tthis.path = path;\n\t\tthis.match = match;\n\t\tthis.target = target;\n\n\t\tthis.keyFocus = keyFocus;\n\n\t\tthis.score = score;\n\t\tthis.keyFullMatch = keyFullMatch;\n\t\tthis.pathFullMatch = pathFullMatch;\n\t\tthis.indexes.path = pathIndexes;\n\t\tthis.indexes.key = keyIndexes;\n\n\t\tthis.ratio = ratio;\n\n\t\tthis.scoring = scoring;\n\t}\n}\n\nclass TermMatch {\n\t/** @type {Number} */\n\tscore;\n\t/** @type {Number[]} */\n\tindexes;\n\tfull;\n\thalf;\n\t/** @type {Number} */\n\tratio;\n\t/** @type {Number} */\n\tconsecutives;\n\t/** @type {Number} */\n\tlongestChain;\n\t/** @type {Score[]} */\n\tscoring;\n\n\tconstructor({ indexes, full, half, ratio, consecutives, longestChain, scoring } = {}) {\n\t\tthis.indexes = indexes;\n\t\tthis.full = full;\n\t\tthis.half = half;\n\t\tthis.ratio = ratio;\n\t\tthis.consecutives = consecutives;\n\t\tthis.longestChain = longestChain;\n\t\tthis.scoring = scoring;\n\t\tthis.score = scoring.reduce((old, scr) => old + scr.value);\n\t}\n}\n\nclass Score {\n\t/** @type {Number} */\n\tvalue;\n\t/** @type {String} */\n\tdescription;\n\n\t/**\n\t * @param {Number} value\n\t * @param {String} description\n\t */\n\tconstructor(value, description) {\n\t\tthis.value = value;\n\t\tthis.description = description;\n\t}\n}\n\nexport class DataInspectorDialog extends FormApplication {\n\tstatic EDITABLE_MODES = ['source', 'override', 'flags'];\n\n\t_path = '';\n\t/** @type {Element} */\n\t_pathEl;\n\t_search = '';\n\t_searchEnd = true;\n\t_functions = false;\n\t_document = false;\n\t_mode = 'rolldata';\n\t_expandedItems = new Set();\n\t_derivedData;\n\t_sourceData;\n\t_temporaryData;\n\t_rollData;\n\t_flagData;\n\t_overrides;\n\t_resultQuality = 0.7;\n\t/** @type {DataStructure} */\n\troot;\n\t/** @type {Actor} */\n\tparentActor;\n\n\tpaths;\n\n\tconstructor(document, options = {}) {\n\t\tconst title = ['Data Inspector'];\n\n\t\tlet parent = null;\n\t\tif (document.actor) parent = document.actor;\n\n\t\tif (parent) title.push(parent.name);\n\n\t\ttitle.push(document.name);\n\n\t\toptions.title = title.join(': ');\n\t\toptions.id = 'lil-data-inspector-' + document.uuid;\n\n\t\tsuper(document, options);\n\n\t\tthis._functions = game.settings.get(CFG.id, CFG.SETTINGS.functions);\n\t\tthis._resultQuality = game.settings.get(CFG.id, CFG.SETTINGS.results);\n\t\tthis._mode = game.settings.get(CFG.id, CFG.SETTINGS.mode);\n\n\t\tthis.document = document;\n\t\tthis.parentActor = parent;\n\n\t\t// Register for item updates\n\t\tdocument.apps[this.appId] = this;\n\t}\n\n\tget template() { return `modules/${CFG.id}/template/inspector.hbs`; }\n\n\tstatic get defaultOptions() {\n\t\tconst _default = super.defaultOptions;\n\t\treturn mergeObject(_default, {\n\t\t\ttitle: 'Data Inspector',\n\t\t\tclasses: [..._default.classes, 'koboldworks', 'data-inspector'],\n\t\t\tresizable: true,\n\t\t\twidth: 520,\n\t\t\theight: 620,\n\t\t\tscrollY: ['div.data'],\n\t\t});\n\t}\n\n\tgetDataVariant(doc, mode) {\n\t\tswitch (mode ?? this._mode) {\n\t\t\tcase 'flags':\n\t\t\t\tif (this._flagData == null) this._flagData = doc.flags ?? {};\n\t\t\t\treturn { data: this._flagData, path: 'flags' };\n\t\t\tcase 'override':\n\t\t\t\tif (this._overrides == null) this._overrides = doc.token?.actorData?.system ?? {};\n\t\t\t\treturn { data: this._overrides, path: 'system' };\n\t\t\tcase 'rolldata':\n\t\t\t\tif (this._rollData == null) this._rollData = doc.getRollData();\n\t\t\t\treturn { data: this._rollData, path: '' };\n\t\t\tcase 'source':\n\t\t\t\tif (this._sourceData == null) this._sourceData = doc.toObject().system;\n\t\t\t\treturn { data: this._sourceData, path: 'system' };\n\t\t\tdefault:\n\t\t\tcase 'derived': {\n\t\t\t\tif (this._derivedData == null) this._derivedData = doc.system;\n\t\t\t\treturn { data: this._derivedData, path: 'system' };\n\t\t\t}\n\t\t}\n\t}\n\n\tgetData() {\n\t\tconst data = super.getData(),\n\t\t\tdoc = this.document,\n\t\t\tisActor = doc instanceof Actor,\n\t\t\ttype = doc.type,\n\t\t\ttypeLabelKey = `${isActor ? 'ACTOR' : 'ITEM'}.Type${type.capitalize()}`,\n\t\t\ttypeLabel = game.i18n.localize(typeLabelKey);\n\n\t\tif (this._mode === 'source') {\n\t\t\tthis._temporaryData ??= createTemporaryDocument(this.document).toObject();\n\t\t}\n\n\t\t// Include prefix to mimic other data structures for easier handling all around (no need for special cases)\n\t\tdata.rolldata = this.getDataVariant(doc, 'rolldata').data;\n\t\tdata.sourcedata = this.getDataVariant(doc, 'source').data;\n\t\tdata.derived = this.getDataVariant(doc, 'derived').data;\n\t\tdata.overrides = this.getDataVariant(doc, 'override').data;\n\t\tdata.flags = this.getDataVariant(doc, 'flags').data;\n\n\t\tconst { data: docData, path: basepath } = this.getDataVariant(doc);\n\n\t\tdata.document = doc;\n\t\t// data.overrides = doc.overrides;\n\t\tdata.type = type;\n\t\tdata.typeLabel = typeLabel;\n\t\tdata.docType = doc.constructor.name;\n\t\tdata.dataType = this._mode;\n\t\tdata.isRollData = this._mode === 'rolldata';\n\t\tdata.isSourceData = this._mode === 'source';\n\t\tdata.isDerivedData = this._mode === 'derived';\n\t\tdata.isOverrideData = this._mode === 'override';\n\t\tdata.resultQuality = this._resultQuality;\n\t\tconst isRollData = this._mode === 'rolldata';\n\t\tconst isFlags = this._mode === 'flags';\n\n\t\tconst basePath = isRollData ? null : 'system';\n\t\tconst { root, all } = DataStructure.recurse(docData, basepath, basepath, this._mode, { includeFunctions: this._functions, document: doc });\n\t\tdata.data = root;\n\t\tthis.root = root;\n\n\t\tdata.model = root.isModel ? root.className : null;\n\t\tif (root.treetype === 'source') {\n\t\t\tdata.model = doc.system instanceof foundry.abstract.DataModel ? doc.system.constructor.name : null;\n\t\t}\n\n\t\troot._sourceData = data.sourcedata;\n\t\troot._derivedData = data.derived;\n\t\troot._rollData = data.rolldata;\n\t\troot._overrides = data.overrides;\n\t\troot._temporaryData = this._temporaryData?.system;\n\n\t\tdata.uuid = doc.uuid;\n\t\tdata.search = this._search;\n\t\tdata.searchEnd = this._searchEnd;\n\t\tdata.includeFunctions = this._functions;\n\t\tdata.includeDocument = this._document;\n\t\tdata.path = this._path;\n\n\t\tdata.TYPES = DATA_TYPES;\n\n\t\treturn data;\n\t}\n\n\t/**\n\t * @param {Element} el\n\t * @param {elementHandler} callback\n\t * @param {args} Arguments\n\t */\n\ttreeWalker(el, callback, ...args) {\n\t\tcallback(el, ...args);\n\t\tconst parent = el.parentElement;\n\t\tif (parent && ['LI', 'UL'].includes(parent.tagName))\n\t\t\tthis.treeWalker(parent, callback, ...args);\n\t}\n\n\thighlightEl(el, enabled = true) {\n\t\t// console.log('Highlighting!');\n\t\tif (this._pathEl) this._pathEl.classList.toggle('selected', false);\n\t\tel.classList.toggle('selected', enabled);\n\t\tthis._pathEl = el;\n\t}\n\n\texpandDataElTree(el) {\n\t\tthis.treeWalker(el, this.expandDataEl, false, true);\n\t}\n\n\t/**\n\t * @param {Element} el\n\t */\n\texpandDataEl(el, record = true, expand = undefined) {\n\t\tel.classList.toggle('hide', false);\n\n\t\tif (el.classList.contains('value') || el.classList.contains('empty')) {\n\t\t\t// console.log('Don\\'t expand empty or value entry');\n\t\t\treturn;\n\t\t}\n\n\t\t// Record open state\n\t\tif (record) {\n\t\t\tconst path = el.dataset.path;\n\t\t\tconst items = this._expandedItems;\n\t\t\tel.classList.contains('collapsed') ? items.add(path) : items.delete(path);\n\t\t}\n\n\t\t// Toggle collapse\n\t\tel.classList.toggle('collapsed', expand !== undefined ? !expand : undefined);\n\t\tel.classList.toggle('expanded', expand);\n\t}\n\n\t/**\n\t * @param {Element} el\n\t */\n\tcollapseAndClearEl(el, hide = false, includeValues = false) {\n\t\tel.classList.toggle('hide', hide);\n\t\tel.dataset.matchQuality = null;\n\t\tel.classList.toggle('selected', false);\n\t\tif (el.classList.contains('value') || el.classList.contains('empty')) return;\n\t\tel.classList.toggle('collapsed', true);\n\t\tel.classList.toggle('expanded', false);\n\t}\n\n\t/**\n\t * @param {Event} ev\n\t */\n\texpandData(ev, el) {\n\t\tev.preventDefault();\n\t\tev.stopPropagation();\n\t\tthis.expandDataEl(el);\n\t}\n\n\t/**\n\t * @param {JQuery} jq\n\t */\n\tactivateListeners(jq) {\n\t\tsuper.activateListeners(jq);\n\n\t\tconst html = jq[0];\n\n\t\tconst header = html.querySelector('.header');\n\n\t\tconst appEl = html.closest('[data-appid]');\n\t\tif (appEl) {\n\t\t\tconst doc = this.document;\n\t\t\tconst item = doc instanceof Item ? doc : null;\n\t\t\tif (item) {\n\t\t\t\tappEl.dataset.itemId = item.id;\n\t\t\t\tappEl.dataset.itemUuid = item.uuid;\n\t\t\t}\n\n\t\t\tconst actor = doc instanceof Actor ? doc : this.parentActor;\n\t\t\tif (actor) {\n\t\t\t\tappEl.dataset.actorId = actor.id;\n\t\t\t\tappEl.dataset.actorUuid = actor.uuid;\n\t\t\t}\n\t\t}\n\n\t\tconst pathInput = header.querySelector('input.path');\n\t\tconst app = this;\n\t\tconst rolldata = this._mode === 'rolldata';\n\t\tconst rawdata = this._mode === 'source';\n\n\t\t/**\n\t\t * @param {Event} ev\n\t\t */\n\t\tfunction changeDataSource(ev) {\n\t\t\tconst value = ev.target.value;\n\t\t\tif (app._mode !== value) {\n\t\t\t\tev.preventDefault();\n\t\t\t\tev.stopPropagation();\n\t\t\t\tev.target.disabled = true;\n\n\t\t\t\t// Convert path to new mode\n\t\t\t\tconst path = app._path;\n\t\t\t\tif (path.length > 0) {\n\t\t\t\t\tconst pathp = path.split('');\n\t\t\t\t\tconst prefix = 'system.';\n\t\t\t\t\tif (path[0] === '@' && app._mode === 'rolldata')\n\t\t\t\t\t\tpathp.splice(0, 1, prefix);\n\t\t\t\t\telse if (path.length > 5 && path.startsWith(prefix) && value === 'rolldata')\n\t\t\t\t\t\tpathp.splice(0, prefix.length, '@');\n\t\t\t\t\tapp._path = pathp.join('');\n\t\t\t\t}\n\n\t\t\t\t// Swap mode\n\t\t\t\tapp._path = app.getBasePath(app._path, app._mode);\n\t\t\t\tapp._mode = value;\n\t\t\t\tapp._lastSearch = undefined;\n\t\t\t\tapp.render(false, { keepCache: true });\n\t\t\t}\n\t\t}\n\n\t\theader.querySelector('select.type').addEventListener('change', changeDataSource);\n\n\t\tfunction changeSearchQuality(ev) {\n\t\t\t// console.log('Quality:', this.value);\n\t\t\tapp._resultQuality = Number(this.value);\n\t\t\tif (app._search.length > 0) app.doSearch(app._search, { forceRefresh: true });\n\t\t}\n\n\t\theader.querySelector('input.search-quality').addEventListener('change', changeSearchQuality);\n\n\t\tfunction copyPath(ev) {\n\t\t\tev.preventDefault();\n\t\t\tev.stopPropagation();\n\t\t\tconst el = this;\n\t\t\tconst path = el.dataset.path;\n\t\t\tconst properPath = rolldata ? `@${path}` : path;\n\t\t\tpathInput.value = properPath;\n\t\t\tapp._path = properPath;\n\t\t\tapp.highlightEl(el, true);\n\t\t\tif (window.isSecureContext) // Required by clipboard\n\t\t\t\treturn copyToClipboard(properPath); // .then(_ => ui.notifications?.info(`\"${properPath}\" copied to clipboard`));\n\t\t}\n\n\t\tjq.on('click', '[data-path]', function (ev) { app.expandData(ev, this); });\n\t\tjq.on('contextmenu', '[data-path]', copyPath);\n\t\tpathInput.addEventListener('input', ev => this.debounceCustomPath(ev.target.value, ev, true))\n\t\tpathInput.addEventListener('change', ev => this.debounceCustomPath(ev.target.value, ev, false));\n\n\t\t// Open previously open paths\n\t\thtml.querySelectorAll('[data-path]').forEach(el => {\n\t\t\tconst path = el.dataset.path;\n\t\t\tif (this._expandedItems.has(path))\n\t\t\t\tthis.expandDataEl(el);\n\t\t});\n\n\t\t/*\n\t\thtml.querySelectorAll('.value[data-id]').forEach(el => {\n\t\t\tel.addEventListener('click', this._copyId);\n\t\t});\n\t\t*/\n\n\t\tconst dataSection = html.querySelector('form > .data');\n\t\tdataSection.addEventListener('dblclick', function openEditor(ev) {\n\t\t\tev.preventDefault();\n\t\t\tev.stopPropagation();\n\n\t\t\tif (DataInspectorDialog.EDITABLE_MODES.includes(app._mode)) {\n\t\t\t\tconst el = ev.target;\n\t\t\t\tconst ael = el.dataset.path ? el : el.closest('[data-path]');\n\t\t\t\tif (ael) app._openValueEditor(ev, ael.dataset.path);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tui.notifications.warn(`Editing not supported in \"${app._mode}\" mode!`);\n\t\t\t}\n\t\t});\n\t\t/*\n\t\tdataSection.querySelectorAll('.data-element[data-path]').forEach(el => {\n\t\t\tconst sel = el.querySelector('.details > .value');\n\t\t\tsel.addEventListener('dblclick', function (ev) { app._openValueEditor(ev, el.dataset.path); });\n\t\t});\n\t\t*/\n\n\t\tconst buildSearchCache = (el) => {\n\t\t\tconst path = el.dataset.path;\n\t\t\tconst key = el.dataset.key;\n\t\t\tconst label = el.querySelector('h4');\n\t\t\tthis.paths.set(path, {\n\t\t\t\tpath,\n\t\t\t\tkey,\n\t\t\t\telement: el,\n\t\t\t\tlabel: label.textContent,\n\t\t\t});\n\t\t}\n\n\t\tconst useTooltips = game.settings.get(CFG.id, CFG.SETTINGS.tooltip);\n\n\t\tconst paths = dataSection.querySelectorAll('li[data-path]');\n\t\tconst pathPrefix = this._mode === 'rolldata' ? '@' : '';\n\t\tpaths.forEach(el => {\n\t\t\tif (!useTooltips) return;\n\t\t\tconst dEl = el.querySelector('.details');\n\t\t\tdEl?.addEventListener('mouseenter', async ev => {\n\t\t\t\tconst path = el.dataset.path;\n\n\t\t\t\tlet dpath = path;\n\t\t\t\tif (app._mode !== 'rolldata') {\n\t\t\t\t\tconst parts = path.split('.');\n\t\t\t\t\tparts.shift();\n\t\t\t\t\tdpath = parts.join('.');\n\t\t\t\t}\n\n\t\t\t\tconst dd = this.root?.getAtPath(dpath);\n\t\t\t\tconst typeId = dd.typeId;\n\t\t\t\tconst typeName = typeId !== DATA_TYPES.custom ? DATA_TYPE_INVERTED[typeId] : dd.className;\n\n\t\t\t\tconst isFlags = dd.treetype === 'flags';\n\n\t\t\t\tconst templateData = {\n\t\t\t\t\tdd,\n\t\t\t\t\tpath: pathPrefix + path,\n\t\t\t\t\ttype: typeName,\n\t\t\t\t\tdocumentId: dd.documentId,\n\t\t\t\t\tisContainer: (dd.isContainer || dd.isDocument),\n\t\t\t\t\tchildren: (dd.isContainer || dd.isDocument) ? dd.children.length : null,\n\t\t\t\t\tisString: dd.isString,\n\t\t\t\t\tlength: dd.isString ? dd.value.length : null,\n\t\t\t\t\ttreetype: dd.treetype,\n\t\t\t\t\tnotFlags: !isFlags,\n\t\t\t\t\tinData: {\n\t\t\t\t\t\trolldata: {\n\t\t\t\t\t\t\tshow: !isFlags && dd.treetype !== 'rolldata',\n\t\t\t\t\t\t\tlabel: 'DataInspector.Data.Roll',\n\t\t\t\t\t\t\tpresent: !isFlags ? dd.inRollData : false,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tderived: {\n\t\t\t\t\t\t\tshow: !isFlags && dd.treetype !== 'derived',\n\t\t\t\t\t\t\tlabel: 'DataInspector.Data.Derived',\n\t\t\t\t\t\t\tpresent: !isFlags ? dd.inDerivedData : false,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsource: {\n\t\t\t\t\t\t\tshow: !isFlags && dd.treetype !== 'source',\n\t\t\t\t\t\t\tlabel: 'DataInspector.Data.Source',\n\t\t\t\t\t\t\tpresent: !isFlags ? dd.inSourceData : false,\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttemporary: {\n\t\t\t\t\t\t\tshow: dd.treetype === 'source',\n\t\t\t\t\t\t\tlabel: 'DataInspector.Data.Temporary',\n\t\t\t\t\t\t\tpresent: !isFlags ? dd.inTemporaryData : false,\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tconst text = await renderTemplate(`modules/${CFG.id}/template/tooltip.hbs`, templateData);\n\n\t\t\t\t// Add tooltip\n\t\t\t\t/*\n\t\t\t\tconst inData = [];\n\t\t\t\tif (v.root.treetype !== 'flags') {\n\t\t\t\t\tif (v.root.treetype !== 'rolldata') inData.push({ label: 'Roll Data', present: v.inRollData });\n\t\t\t\t\tif (v.root.treetype !== 'derived') inData.push({ label: 'Derived', present: v.inDerivedData });\n\t\t\t\t\tif (v.root.treetype !== 'source')\n\t\t\t\t\t\tinData.push({ label: 'Source', present: v.inSourceData });\n\t\t\t\t\telse\n\t\t\t\t\t\tinData.push({ label: 'Temporary', present: v.inTemporaryData });\n\t\t\t\t}\n\t\t\t\t*/\n\n\t\t\t\t/*\n\t\t\t\tttcontent.push('<div class=\"in-data\">');\n\t\t\t\tfor (const d of inData) {\n\t\t\t\t\tttcontent.push('<div class=\"data-source\">', '<label class=\"header\">', d.label, '</label>', '<span class=\"value\">', d.present ? '\u2713' : '\u2717', '</span>', '</div>');\n\t\t\t\t}\n\t\t\t\t*/\n\n\t\t\t\tgame.tooltip.activate(dEl, { text, direction: 'UP', cssClass: 'data-inspector-tooltip' });\n\t\t\t}, { passive: true });\n\n\t\t\tdEl?.addEventListener('mouseleave', () => game.tooltip.deactivate(), { passive: true });\n\t\t});\n\n\t\tconst search = header.querySelector('input.search');\n\t\tsearch.addEventListener('change', ev => this.debounceSearch(ev.target.value, ev, false), { passive: true });\n\t\tsearch.addEventListener('input', ev => this.debounceSearch(ev.target.value, ev, true), { passive: true });\n\n\t\tthis.paths = new Collection();\n\t\tpaths.forEach(el => buildSearchCache(el));\n\n\t\t/*\n\t\tconst sEnd = header.querySelector('input.search-end');\n\t\tsEnd.addEventListener('change', ev => {\n\t\t\tthis._searchEnd = ev.target.checked;\n\t\t\tthis.debounceSearch(this._search);\n\t\t});\n\t\t*/\n\n\t\tconst functions = header.querySelector('input.functions');\n\t\tfunctions.addEventListener('change', ev => {\n\t\t\tev.preventDefault();\n\t\t\tev.stopPropagation();\n\n\t\t\tthis._functions = ev.target.checked;\n\t\t\tthis.render();\n\t\t});\n\n\t\t/*\n\t\tconst indocument = header.querySelector('input.document');\n\t\tindocument.addEventListener('change', ev => {\n\t\t\tthis._document = ev.target.checked;\n\t\t\tthis.render();\n\t\t});\n\t\t*/\n\n\t\tif (this._search.length) this.debounceSearch(this._search);\n\n\t\tif (this._functions) {\n\t\t\tif (!this._getGetterValueBound) this._getGetterValueBound = this._getGetterValue.bind(this);\n\t\t\tdataSection.addEventListener('click', function (ev) {\n\t\t\t\tif (!ev.target.matches('.getter.value')) return;\n\t\t\t\tev.preventDefault();\n\t\t\t\tev.stopPropagation();\n\t\t\t\tapp._getGetterValueBound(ev);\n\t\t\t});\n\t\t}\n\n\t\t// Always expand selected path\n\t\tthis.expandSelectedPath();\n\t}\n\n\t/**\n\t * @param {Event} event\n\t * @param {String} path\n\t */\n\t_openValueEditor(event, path) {\n\t\tif (!game.settings.get(CFG.id, CFG.SETTINGS.allowEditing))\n\t\t\treturn ui.notifications.warn('Editing has been disabled.');\n\n\t\tconst pp = path.split('.');\n\t\tconst doc = this.document;\n\t\tlet currentData = doc;\n\n\t\twhile (pp.length > 0) {\n\t\t\tconst part = pp.shift();\n\t\t\tcurrentData = currentData[part];\n\t\t\tif (currentData == null && pp.length > 0)\n\t\t\t\treturn ui.notifications.warn(`Failed to navigate to the target datapath: ${path}`);\n\t\t\tif (Array.isArray(currentData) && pp.length > 0)\n\t\t\t\treturn ui.notifications.warn(`Editing arrays or values inside of arrays not supported: ${path}`);\n\t\t}\n\n\t\tconst type = getTypeId(currentData);\n\t\tconst isSupported = ValueEditor.supportedTypes.includes(type);\n\t\tif (!ValueEditor.supportedTypes.includes(type)) {\n\t\t\tconst allowUnsupported = game.settings.get(CFG.id, CFG.SETTINGS.allowEditingUnsupported);\n\t\t\tif (!allowUnsupported)\n\t\t\t\treturn ui.notifications.warn(`Unsupported type for editing: ${DATA_TYPE_INVERTED[type]}`);\n\t\t}\n\n\t\t// Things went okay\n\t\t// console.log('READY TO EDIT:', path, type, currentData);\n\t\tconst p = new Promise((resolve) => {\n\t\t\tnew ValueEditor(this.document, path, type, { isToken: this._mode === 'override', app: this, resolve })\n\t\t\t\t.render(true, { focus: true });\n\t\t});\n\n\t\tif (this._mode === 'flags')\n\t\t\tp.then(_ => {\n\t\t\t\t// Refresh flag data. Doesn't happen automatically like with other data types.\n\t\t\t\tthis._flagData = null;\n\t\t\t\tthis.render();\n\t\t\t});\n\t}\n\n\t_copyId(_event) {\n\t\tconst id = this.dataset.id;\n\t\tconsole.log('Copying ID:', id);\n\t\treturn copyToClipboard(id);\n\t}\n\n\t_getGetterValueBound;\n\n\t/**\n\t * @param {Event} event\n\t */\n\t_getGetterValue(event) {\n\t\tevent.stopImmediatePropagation();\n\t\tevent.preventDefault();\n\t\tconst target = event.target;\n\t\tif (!target) return;\n\t\ttarget.removeEventListener('click', this._getGetterValueBound);\n\t\tthis._resolveGetter(target);\n\t}\n\n\t/**\n\t * @param {Element} element\n\t */\n\t_resolveGetter(element) {\n\t\tconst el = element.dataset.path ? element : element.closest('[data-path]');\n\t\tif (!el) return;\n\t\t/** @type {String} */\n\t\tconst path = el.dataset.path;\n\n\t\t// console.log('Getter:', path, el);\n\t\tlet parentPath = path.split('.');\n\t\tparentPath.shift(); // remove data\n\t\tparentPath = parentPath.join('.');\n\t\t// console.log('Parentage:', parentPath);\n\t\tconst ds = this.root.getAtPath(parentPath);\n\t\tconst value = ds.value;\n\n\t\telement.textContent = value;\n\t\telement.classList.add('resolved');\n\t\tconst type = getTypeId(value);\n\t\tconst c = new DataStructure({ key: ds.key, path: ds.path, value, type });\n\t\telement.classList.add(c.type);\n\t\t// console.log('GET:', c);\n\t}\n\n\t/**\n\t * Strip @ and data. prefix\n\t * @param {String} path\n\t * @param {\"rolldata\"|\"source\"|\"derived\"|\"override\"} oldMode\n\t * @param {\"rolldata\"|\"source\"|\"derived\"|\"override\"} targetMode\n\t * @return {String}\n\t */\n\tgetBasePath(path, oldMode, targetMode) {\n\t\toldMode ??= this._mode;\n\t\tif (oldMode === 'rolldata')\n\t\t\treturn path.replace(/^@/, '');\n\t\tif (targetMode === 'rolldata')\n\t\t\treturn path.replace(/^system\\./, '@');\n\t\treturn path;\n\t}\n\n\texpandSelectedPath() {\n\t\tif (this._path.length == 0) return;\n\n\t\tconst path = this.getBasePath(this._path);\n\n\t\t// console.log({ path, source: this._path, mode: this._mode });\n\t\tconst p = this.paths.get(path);\n\t\tif (p) {\n\t\t\tthis.expandDataElTree(p.element);\n\t\t\tthis._pathEl = p.element;\n\t\t\tthis.highlightEl(this._pathEl, true);\n\t\t\tthis._pathEl.scrollIntoView({ block: 'center' });\n\t\t}\n\t}\n\n\tinputDebounceDelay = 250;\n\tsearchDelayTimer;\n\tselectDelayTimer;\n\n\t/**\n\t * @param {String} search\n\t * @param {Event} event\n\t * @param {Boolean} active\n\t */\n\tdebounceSearch(search, event, active = false) {\n\t\tclearTimeout(this.searchDelayTimer);\n\t\t// Increase delay for short queries and shorten it for end of input\n\t\tif (search.length === 0) active = false;\n\t\tconst delay = Math.clamped(active ? search.length > 3 ? this.inputDebounceDelay : this.inputDebounceDelay * 2 : this.inputDebounceDelay / 2, 150, 500);\n\t\tthis.searchDelayTimer = setTimeout(_ => this.doSearch(search), delay);\n\t}\n\n\t/**\n\t * @param {String} input\n\t * @param {Event} event\n\t * @param {Boolean} active\n\t */\n\tdebounceCustomPath(input, event, active = false) {\n\t\tthis._path = input;\n\t\tif (this._pathEl) {\n\t\t\tthis._pathEl.classList.toggle('selected', false);\n\t\t\tthis._pathEl = null;\n\t\t}\n\t\tclearTimeout(this.selectDelayTimer);\n\t\tif (input.length === 0) active = false;\n\t\tconst delay = active ? input.length > 3 ? this.inputDebounceDelay : this.inputDebounceDelay * 2 : this.inputDebounceDelay / 2;\n\t\t// console.log('SelectDebounce:', search, delay);\n\t\tthis.selectDelayTimer = setTimeout(_ => this.selectCustomPath(input), delay);\n\t}\n\n\t/**\n\t * @param {String} input\n\t */\n\tselectCustomPath(input) {\n\t\tthis._path = input;\n\t\tthis.expandSelectedPath();\n\t\tconst path = this.paths.get(input);\n\t\t// console.log('SELECTING:', input, path);\n\t\tif (path) {\n\t\t\tthis.expandDataElTree(path.element);\n\t\t\tthis.highlightEl(path.element);\n\t\t\tthis._pathEl = path.element;\n\t\t}\n\t\telse {\n\t\t\tthis._pathEl = null;\n\t\t}\n\t}\n\n\t_lastSearch;\n\tlastEndSerch;\n\t/**\n\t * @param {String} search\n\t */\n\tdoSearch(search, { forceRefresh = false } = {}) {\n\t\tthis._search = search;\n\t\tconsole.log('Searching:', this._search);\n\n\t\tif (forceRefresh !== true && this._lastSearch === search && this.lastEndSerch === this._searchEnd) return;\n\n\t\tthis._lastSearch = search;\n\t\tthis.lastEndSerch = this._searchEnd;\n\n\t\tif (search.length == 0) {\n\t\t\tthis.paths.forEach(p => this.collapseAndClearEl(p.element, false));\n\t\t\tthis.expandSelectedPath();\n\t\t\treturn;\n\t\t}\n\n\t\t// console.log('DATA INSPECTOR |', Date.now(), 'Searching:', search, 'EndFocus:', this._searchEnd);\n\n\t\t// Collapse all first to ensure expansion happens smoothly\n\t\tthis.paths.forEach(p => this.collapseAndClearEl(p.element, true));\n\n\t\tconst term = search.toLowerCase().split('');\n\n\t\t// Do actual search\n\t\tfunction matchTerm(term, subject, { harsh = true } = {}) {\n\t\t\tconst indexes = [];\n\t\t\tconst subjectParts = subject.toLowerCase().split('');\n\t\t\tlet consecutives = 0, longestChain = 0;\n\t\t\tlet si = 0, sm = term[0], lastMatch = -2;\n\t\t\tlet lastChain = 1;\n\t\t\tconst scoring = [];\n\t\t\tconst updateLongestChain = () => {\n\t\t\t\tif (lastChain > longestChain) longestChain = lastChain;\n\t\t\t\tlastChain = 1;\n\t\t\t}\n\t\t\tfor (let i = 0; i < subjectParts.length; i++) {\n\t\t\t\tif (subjectParts[i] === sm) {\n\t\t\t\t\tindexes.push(i);\n\t\t\t\t\t// Give score for subsequent matches\n\t\t\t\t\tif (lastMatch === i - 1) {\n\t\t\t\t\t\tscoring.push(new Score(3, `Consecutive [${i}]: +3`));\n\t\t\t\t\t\tconsecutives++;\n\t\t\t\t\t\tlastChain++;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tscoring.push(new Score(1, `Match [${i}]: +1`));\n\t\t\t\t\t\tupdateLongestChain();\n\t\t\t\t\t}\n\t\t\t\t\tlastMatch = i;\n\t\t\t\t\t// Add score if match is closer to the end\n\t\t\t\t\tconst endBonus = Math.clamped(Math.round((subjectParts.length - i) / 5), 0, 3);\n\t\t\t\t\tif (endBonus > 0) scoring.push(new Score(endBonus, `End bonus: +${endBonus}`));\n\t\t\t\t\t// End when there's nothing left to search\n\t\t\t\t\tsm = term[++si];\n\t\t\t\t\tif (sm === undefined) break;\n\t\t\t\t}\n\t\t\t}\n\t\t\tupdateLongestChain();\n\n\t\t\t// Basic score for matched letters\n\t\t\tif (indexes.length > 0) scoring.push(new Score(indexes.length * 3, `Matched letters bonus: ${indexes.length * 3}`));\n\t\t\telse scoring.push(new Score(-100, 'No matches: -100'));\n\n\t\t\t// Offset less accurate matches\n\t\t\t/*\n\t\t\tscore -= subjectParts.length;\n\t\t\tscoring.push(`Accuracy penalty: -${subjectParts.length}`);\n\t\t\t*/\n\n\t\t\t// Search term found fully\n\t\t\tconst full = indexes.length == term.length;\n\t\t\tif (full) scoring.push(new Score(20, 'Full match: +20'));\n\n\t\t\t// Reduce score of search terms that are matched only partially\n\t\t\tconst half = indexes.length < Math.floor(term.length / 2) - 2;\n\t\t\tif (harsh) {\n\t\t\t\tconst cumulative = scoring.reduce((prev, cur) => cur.value + prev),\n\t\t\t\t\thalfScore = -Math.floor(cumulative / 2);\n\t\t\t\tif (half) scoring.push(new Score(halfScore, `Partial match: ${halfScore}`));\n\t\t\t\tif (longestChain <= 1) scoring.push(new Score(-20, 'Short chains: -20'));\n\t\t\t}\n\n\t\t\treturn new TermMatch({ indexes, full, half, ratio: (consecutives + 1) / term.length, consecutives, longestChain, scoring });\n\t\t}\n\n\t\tlet fullMatches0 = 0, fullMatches1 = 0;\n\n\t\t// Extremely simple search\n\t\t// TODO: Allow skipping letters in search term but impose negative score if that is the only way to get them to match.\n\t\tconst results = this.paths.reduce((results, target) => {\n\t\t\tconst matchPath = matchTerm(term, target.path),\n\t\t\t\tmatchKey = matchTerm(term, target.key);\n\n\t\t\tif (matchKey.full) fullMatches0++;\n\t\t\tif (matchPath.full) fullMatches1++;\n\n\t\t\tlet match = matchPath.ratio > 0.5,\n\t\t\t\tratio = matchPath.ratio;\n\n\t\t\tif (this._keyFocus) {\n\t\t\t\tmatchPath.score /= 5;\n\t\t\t\tratio = matchKey.ratio;\n\t\t\t\tmatch = matchKey.ratio > matchPath.ratio;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tratio += matchKey.ratio * 2;\n\t\t\t\tratio /= 3;\n\t\t\t}\n\n\t\t\tresults.push(new SearchResult({\n\t\t\t\tpath: target.path,\n\t\t\t\tmatch,\n\t\t\t\ttarget,\n\t\t\t\tkeyFocus: this._keyFocus,\n\t\t\t\tscore: matchPath.score / 2 + matchKey.score * 2,\n\t\t\t\tkeyFullMatch: matchKey.full,\n\t\t\t\tpathFullMatch: matchPath.full,\n\t\t\t\tpathIndexes: matchPath.indexes,\n\t\t\t\tkeyIndexes: matchKey.indexes,\n\t\t\t\tratio,\n\t\t\t\tscoring: { full: matchPath.scoring, key: matchKey.scoring }\n\t\t\t}));\n\n\t\t\treturn results;\n\t\t}, []);\n\n\t\tresults.sort((a, b) => {\n\t\t\tif (a.full && !b.full) return -1;\n\t\t\tif (b.full && !a.full) return 1;\n\t\t\treturn b.score - a.score;\n\t\t});\n\n\t\tconst Break = {};\n\n\t\t// Format results\n\t\ttry {\n\t\t\tresults.forEach((r, index) => {\n\t\t\t\tconst el = r.target.element;\n\t\t\t\tel.dataset.searchScore = `${r.score}`;\n\t\t\t\tel.dataset.searchRatio = `${r.ratio}`;\n\n\t\t\t\tlet q = 'decent';\n\t\t\t\tif (r.mismatch) q = 'mismatch';\n\t\t\t\telse if (r.bad) q = 'bad';\n\t\t\t\telse if (r.good) q = 'good';\n\t\t\t\tel.dataset.matchQuality = q;\n\n\t\t\t\tif (fullMatches0 > 0) {\n\t\t\t\t\tif (r.ratio > this._resultQuality) this.expandDataElTree(el);\n\t\t\t\t}\n\t\t\t\telse if (!r.bad)\n\t\t\t\t\tthis.expandDataElTree(el);\n\n\t\t\t\t// if (!r.mismatch) console.log(r.path, { score: r.score }, { r, quality: el.dataset.matchQuality });\n\n\t\t\t\t// if (index > 20) throw Break;\n\t\t\t});\n\t\t}\n\t\tcatch (err) {\n\t\t\tif (err !== Break) throw err;\n\t\t}\n\n\t\tthis.expandSelectedPath();\n\t}\n\n\t/**\n\t * @override\n\t */\n\tasync close(opts) {\n\t\t// Unregister updates\n\t\tdelete this.document.apps[this.appId];\n\t\treturn super.close(opts);\n\t}\n\n\trender(force = false, options = {}) {\n\t\tif (!options.keepCache) {\n\t\t\tthis._rollData = undefined;\n\t\t\tthis._sourceData = undefined;\n\t\t\tthis._derivedData = undefined;\n\t\t\tthis._overrides = undefined;\n\t\t\tthis._lastSearch = undefined;\n\t\t}\n\n\t\treturn super.render(force, options);\n\t}\n}\n", "import { CFG } from './config.mjs';\nimport { DataInspectorDialog } from './dialog.mjs';\n\nconst refreshActiveDialogs = () => Object.values(ui.windows)\n\t.forEach(app => app instanceof DataInspectorDialog ? app.render() : null);\n\nHooks.once('init', function registerSettings() {\n\tgame.settings.register(CFG.id, CFG.SETTINGS.mode, {\n\t\tname: 'DataInspector.Settings.DefaultMode',\n\t\thint: 'DataInspector.Settings.DefaultModeHint',\n\t\tscope: 'client',\n\t\tconfig: true,\n\t\ttype: String,\n\t\tdefault: 'rolldata',\n\t\tchoices: {\n\t\t\trolldata: 'DataInspector.Data.Roll',\n\t\t\tsource: 'DataInspector.Data.Source',\n\t\t\tderived: 'DataInspector.Data.Derived',\n\t\t}\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTINGS.results, {\n\t\tname: 'DataInspector.Settings.ResultQuality',\n\t\thint: 'DataInspector.Settings.ResultQualityHint',\n\t\tscope: 'client',\n\t\tconfig: true,\n\t\ttype: Number,\n\t\tdefault: 0.7,\n\t\trange: { min: 0.0, max: 1.0, step: 0.01 }\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTINGS.functions, {\n\t\tname: 'DataInspector.Settings.IncludeFunctions',\n\t\thint: 'DataInspector.Settings.IncludeFunctionsHint',\n\t\tscope: 'client',\n\t\tconfig: true,\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTINGS.allowEditing, {\n\t\tname: 'DataInspector.Settings.AllowEditing',\n\t\thint: 'DataInspector.Settings.AllowEditingHint',\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTINGS.allowEditingUnsupported, {\n\t\tname: 'DataInspector.Settings.AllowEditingUnsupported',\n\t\thint: 'DataInspector.Settings.AllowEditingUnsupportedHint',\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTINGS.allowUsers, {\n\t\tname: 'DataInspector.Settings.AllowUsers',\n\t\thint: 'DataInspector.Settings.AllowUsersHint',\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\ttype: Boolean,\n\t\tdefault: true,\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTINGS.tooltip, {\n\t\tname: 'DataInspector.Settings.Tooltip',\n\t\thint: 'DataInspector.Settings.TooltipHint',\n\t\tconfig: true,\n\t\tscope: 'client',\n\t\ttype: Boolean,\n\t\tdefault: true,\n\t\tonChange: () => refreshActiveDialogs()\n\t});\n});\n", "import { CFG } from './config.mjs';\nimport { DataInspectorDialog } from './dialog.mjs';\n\n/**\n * @param {Actor|Item} document\n */\nconst openInspector = (doc) => {\n\tconst oldApp = Object.values(doc.apps)\n\t\t.find(app => app instanceof DataInspectorDialog);\n\tif (oldApp) oldApp.render(true, { focus: true });\n\telse new DataInspectorDialog(doc).render(true);\n}\n\nconst injectHeaderDataButton = (sheet, buttons) => {\n\tconst allowUsers = game.settings.get(CFG.id, CFG.SETTINGS.allowUsers);\n\tif (!allowUsers && !game.user.isGM) return;\n\n\tbuttons.unshift({\n\t\tclass: 'data-inspector',\n\t\ticon: 'fas fa-atom',\n\t\tlabel: game.i18n.localize('DataInspector.DataButton'),\n\t\tonclick: _ => openInspector(sheet.document),\n\t});\n}\n\n/**\n * @param {JQuery} html\n * @param {Object[]} entries\n */\nconst injectContextDataButton = ([directory], entries) => {\n\tentries.push({\n\t\tname: 'DataInspector.Context.OpenInspector',\n\t\ticon: '<i class=\"fas fa-atom\"></i>',\n\t\tcondition: () => {\n\t\t\tconst allowUsers = game.settings.get(CFG.id, CFG.SETTINGS.allowUsers);\n\t\t\treturn !(!allowUsers && !game.user.isGM);\n\t\t},\n\t\tcallback: async ([entry]) => {\n\t\t\tconst directoryId = directory.id,\n\t\t\t\tpackId = directory.dataset.pack,\n\t\t\t\tdocumentId = entry.dataset.documentId;\n\n\t\t\tlet doc;\n\t\t\tif (packId)\n\t\t\t\tdoc = await game.packs.get(packId)?.getDocument(documentId);\n\t\t\telse if (directoryId === 'items')\n\t\t\t\tdoc = game.items.get(documentId);\n\t\t\telse if (directoryId === 'actors')\n\t\t\t\tdoc = game.actors.get(documentId);\n\t\t\telse\n\t\t\t\treturn void console.error('Unknown data source:', { directory, entry });\n\n\t\t\tif (doc)\n\t\t\t\topenInspector(doc);\n\t\t\telse\n\t\t\t\tconsole.warning('Document not found:', { documentId, directoryId, packId });\n\t\t}\n\t});\n}\n\nHooks.once('ready', async () => {\n\tconst C = CFG.COLORS;\n\n\tconst allowUsers = game.settings.get(CFG.id, CFG.SETTINGS.allowUsers);\n\tif (!allowUsers && !game.user.isGM)\n\t\treturn void console.log(`%cDATA INSPECTOR%c \uD83D\uDD0D | %c${mod.version}%c | User access blocked in settings.`, C.main, C.unset, C.id, C.unset);\n\n\t// Load templates\n\tconst templates = ['object', 'inspector', 'value', 'object-data'];\n\tawait loadTemplates(templates.map(t => `modules/${CFG.id}/template/${t}.hbs`));\n\n\t// Register API\n\tconst mod = game.modules.get(CFG.id);\n\tmod.api = {\n\t\tinspect: openInspector,\n\t};\n\n\t// Fetch in-built system specific extensions\n\t// const systemExtPath = `modules/${CFG.module}/systems/${game.system.id}.mjs`;\n\n\tif (['pf1'].includes(game.system.id)) { // Temporary limiter on import() errors\n\t\tawait import(`./systems/${game.system.id}.mjs`)\n\t\t\t.then(() => console.log('%cDATA INSPECTOR%c \uD83D\uDD0D | System extensions loaded %c\u2714', C.main, C.unset, 'color:green'))\n\t\t\t.catch(() => console.log('%cDATA INSPECTOR%c \uD83D\uDD0D | System extensions not found %c\u2718', C.main, C.unset, 'color:red'));\n\t}\n\n\tconsole.log(`%cDATA INSPECTOR%c \uD83D\uDD0D | %c${mod.version}%c | READY`, C.main, C.unset, C.id, C.unset);\n});\n\n// Header buttons\nHooks.on('getActorSheetHeaderButtons', injectHeaderDataButton);\nHooks.on('getItemSheetHeaderButtons', injectHeaderDataButton);\n\n// Context menus\nHooks.on('getItemDirectoryEntryContext', injectContextDataButton);\nHooks.on('getActorDirectoryEntryContext', injectContextDataButton);\nHooks.on('getCompendiumEntryContext', injectContextDataButton);\n"],
  "mappings": "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",
  "names": ["term", "results"]
}
